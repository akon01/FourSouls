"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var core_1 = require("@ts-ioc/core");
var joinpoints_1 = require("../joinpoints");
var IAdvisorChain_1 = require("./IAdvisorChain");
var IAdvisorProceeding_1 = require("./IAdvisorProceeding");
var NonePointcut_1 = require("../decorators/NonePointcut");
/**
 * advisor chain.
 *
 * @export
 * @class AdvisorChain
 * @implements {IAdvisorChain}
 */
var AdvisorChain = /** @class */ (function () {
    function AdvisorChain(joinPoint) {
        this.joinPoint = joinPoint;
        this.actions = [];
    }
    /**
     * register next action.
     *
     * @param {Express<Joinpoint, any>} action
     * @memberof AdvisorChain
     */
    AdvisorChain.prototype.next = function (action) {
        this.actions.push(action);
    };
    /**
     * get recognizer of this advisor.
     *
     * @returns {IRecognizer}
     * @memberof AdvisorChain
     */
    AdvisorChain.prototype.getRecognizer = function () {
        return this.container.get(core_1.RecognizerToken, this.joinPoint.state);
    };
    /**
     * process the advices.
     *
     * @memberof AdvisorChain
     */
    AdvisorChain.prototype.process = function () {
        var _a;
        var alias = this.getRecognizer().recognize(this.joinPoint.returning);
        (_a = this.container.get(IAdvisorProceeding_1.AdvisorProceedingToken, alias)).proceeding.apply(_a, [this.joinPoint].concat(this.actions));
    };
    AdvisorChain.getClassAnnations = function () {
        return { "name": "AdvisorChain", "params": { "constructor": ["joinPoint"], "next": ["action"], "getRecognizer": [], "process": [] } };
    };
    tslib_1.__decorate([
        core_1.Inject(core_1.ContainerToken),
        tslib_1.__metadata("design:type", Object)
    ], AdvisorChain.prototype, "container", void 0);
    AdvisorChain = tslib_1.__decorate([
        NonePointcut_1.NonePointcut(),
        core_1.Injectable(IAdvisorChain_1.AdvisorChainToken),
        tslib_1.__metadata("design:paramtypes", [joinpoints_1.Joinpoint])
    ], AdvisorChain);
    return AdvisorChain;
}());
exports.AdvisorChain = AdvisorChain;

//# sourceMappingURL=../sourcemaps/access/AdvisorChain.js.map
