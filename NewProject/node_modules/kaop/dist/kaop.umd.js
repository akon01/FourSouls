!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.kaop={})}(this,function(e){"use strict";function t(e){return!e.advice}var r={isMethod:t,isValidArraySignature:function(e){return e.every(function(e){return"function"==typeof e})&&1===e.filter(t).length},getMethodFromArraySignature:function(e){return e.find(t)},isAsync:function(e){return!!e.toString().match(/[a-zA-Z$_]\.commit/)},createInstance:function(e,t){return t.unshift(null),new(Function.prototype.bind.apply(e,t))}};function n(e,t,n,i){var c,a;return"constructor"!==t&&n.some(function(e){return r.isAsync(e)})?o(e,t,n,i,new Promise(function(e,t){c=e,a=t}),c,a):o(e,t,n,i)}function o(e,t,n,o,i,c,a){return function(){var u=-1;function s(){var e=Array.prototype.slice.call(arguments);if(f.args.push.apply(f.args,e),n[++u]){var t=n[u];if(r.isMethod(t)){if(!f.prevented)try{if(o){var s=o(f);Object.assign(s,f.scope),f.result=f.scope=s}else f.result=t.apply(f.scope,f.args)}catch(e){f.exception=e}}else t.call(void 0,f);r.isAsync(t)||f.commit()}else{if(f.exception){if(!i)throw f.exception;a(f.exception)}i&&c(f.result)}}var f={args:Array.prototype.slice.call(arguments),scope:this,key:t,method:r.getMethodFromArraySignature(n),target:e,ES6newTarget:new.target,exception:void 0,prevented:void 0,result:void 0,commit:s,prevent:function(){f.prevented=!0},handle:function(){var e=f.exception;return delete f.exception,e},skip:function(){u=n.findIndex(r.isMethod)-1}};return s(),i||f.result}}var i={advice:function(e){return e.advice=1,e},aspect:function(e){return function(t){return Object.keys(t).reduce(e,t)}},wove:function(e,t){var o=Object.assign({},t);for(var i in o)o[i]instanceof Array&&r.isValidArraySignature(o[i])&&(o[i]=n(e,i,o[i]));return o},createProxyFn:n};function c(e,t,r){function n(){"function"==typeof this.constructor&&this.constructor.apply(this,arguments)}n.super=e,n.signature=t;var o=i.wove(n,t);return n.prototype=Object.assign(Object.create(e.prototype),o),n}var a=function(e){return c(function(){},e)},u=function(e,t){return c(e,t)},s=function(e){for(var t in e.signature)e.signature[t]instanceof Array&&r.isValidArraySignature(e.signature[t])&&(e.prototype[t]=r.getMethodFromArraySignature(e.signature[t]));return e},f={apply:i.advice(function(e){e.target.super.prototype[e.key].apply(e.scope,e.args)}),implement:i.advice(function(e){e.args.unshift(e.target.super.prototype[e.key].bind(e.scope))})},p={args:function(){var e=Array.prototype.slice.call(arguments);return i.advice(function(t){if("constructor"!==t.key)throw new Error("inject only available in constructor");e.forEach(function(e){t.args.push(e())})})},assign:function(e){return i.advice(function(t){for(var r in e){var n=e[r];t.scope[r]=n()}})}},l={factory:function(e){return function(){return r.createInstance(e,Array.prototype.slice.call(arguments))}},singleton:function(e){var t;return function(){var n=Array.prototype.slice.call(arguments);return t||(t=r.createInstance(e,n)),t}}},y=i,d={createClass:a,extend:u,clear:s,override:f,inject:p,provider:l,reflect:y};e.default=d,e.createClass=a,e.extend=u,e.clear=s,e.override=f,e.inject=p,e.provider=l,e.reflect=y,Object.defineProperty(e,"__esModule",{value:!0})});
