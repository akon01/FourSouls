{"version":3,"sources":["aop.umd.min.js"],"names":["global","factory","exports","module","require","define","amd","aop","umd","js","tslib","this","tslib_1","core_1","unwrapExports","x","__esModule","Object","prototype","hasOwnProperty","call","createCommonjsModule","fn","AopActions_1","AopActions","defineProperty","value","IAdvisor","AdvisorToken","InjectToken","RegistAspectAction_1","RegistAspectAction","_super","registAspect","__extends","working","container","data","type","targetType","matchs","getLifeScope","getClassDecorators","surm","actions","includes","hasOwnClassMetadata","name","aspectMgr","get","raiseContainer","forEach","metadata","getOwnTypeMetadata","Array","isArray","length","meta","isClass","add","getClassAnnations","params","constructor","ActionComposite","NonePointcut","createClassDecorator","isValideAspectTarget_1","isValideAspectTarget","isBaseType","IAdvisorChainFactory","AdvisorChainFactoryToken","JoinpointState_1","JoinpointState","IJoinpoint","JoinpointToken","Joinpoint_1","Joinpoint","options","provJoinpoint","fullName","args","returning","throwing","state","advicer","annotations","target","__decorate","Injectable","__metadata","joinpoints","__exportStar","IAdvisorChain","AdvisorChainToken","AdvisorChainFactory_1","AdvisorChainFactory","advisor","advices","getAdvicers","adviceType","invoaction","joinPoint","valueOrthrowing","undefined","Before","before","Pointcut","pointcut","After","after","AfterThrowing","afterThrowing","AfterReturning","afterReturning","_this","cloneJp","lang","assign","invokeAdvice","isUndefined","advChain","resolve","next","jp","process","_a","providers","push","Provider","createExtends","inst","provider","_cache_JoinPoint","advice","create","annotationArgName","curj","annotationName","d_1","test","filter","a","decorator","getContainer","aspectType","syncInvoke","apply","propertyKey","concat","__param","Inject","ContainerToken","IAdvisorProceeding","AdvisorProceedingToken","AdvisorChain_1","AdvisorChain","action","getRecognizer","RecognizerToken","alias","recognize","proceeding","IProxyMethod","ProxyMethodToken","ProxyMethod_1","joinpoints_2","ProxyMethod","_advisor","enumerable","configurable","_liefScope","proceed","methodName","getAdvices","descriptor","set","getMethod","bind","proxy","setMethod","isFunction","propertyMethod","liefScope","_i","arguments","val","exeErr","getMethodMetadatas","getMethodParameters","adChain","err","Singleton","ReturningType_1","ReturningType","AsyncPromiseProceeding_1","AsyncPromiseProceeding","then","returningValue","Promise","promise","AsyncObservableProceeding_1","AsyncObservableProceeding","isObservable","flatMap","isPromise","observable","ReturningRecognizer_1","ReturningRecognizer","sync","SyncProceeding_1","SyncProceeding","access","BindMethodPointcutAction_1","BindMethodPointcutAction","bindMethodPointcut","hasRegister","className","getClassName","methods","decorators","getOwnPropertyDescriptors","forIn","item","allmethods","getParamerterNames","InvokeBeforeConstructorAction_1","InvokeBeforeConstructorAction","providerMap","Around","InvokeAfterConstructorAction_1","InvokeAfterConstructorAction","invokeAfterConstructorAdvices","IAdviceMatcher","AdviceMatcherToken","MatchPointcutAction_1","MatchPointcutAction","matchPointcut","matcher","aspects","adviceMetas","match","mpt","setAdvices","adviceName","some","isAdviceEquals","advice1","advice2","ExetndsInstanceAction_1","ExetndsInstanceAction","p","ExtendsProvider","extends","AopActionFactory_1","AopActionFactory","invokeBeforeConstructorAdvices","exetndsInstance","Advice","createAdviceDecorator","adapter","afterPointcutAdapter","metadataExtends","createMethodDecorator","arg","isString","isRegExp","setMetadata","Aspect","annotation","within","Advisor_1","Advisor","Map","aspectIocs","key","has","hasRegisterAdvices","keys","m","aspect","metas","getOwnMethodMetadata","defaultContainer","AdviceMatcher_1","AdviceMatcher","aspectMeta","first","indexOf","toString","anno","matched","adviceNames","advices_1","n","adv","matchAspectSelf","points_1","decorators_1","name_1","getOwnPropertyNames","filterPointcut","substring","startsWith","points","matchedPointcut","match_1","matchTypeFactory","map","expresses","method","hasOwnMethodMetadata","pointcuts","trim","tranlateExpress","pointcutReg_1","source","Reflect","getMetadataKeys","mergeExpress","spiltBrace","strExp","expressToFunc","exp","annotation_1","replace","matcher_1","RegExp","classnames_1","split","torken_1","getTokenImpl","idxOr","idxAd","leftExp","rightExp","flag","express","idx","rel","AopModule_1","AopModule","setup","register","lifeScope","LifeScopeToken","addAction","IocState","design","runtime","LifeState","beforeConstructor","AfterInit","onInit","afterConstructor","registerDecorator","IocExt"],"mappings":"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","file":"../aop.umd.min.js","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('tslib'), require('@ts-ioc/core')) :\n\ttypeof define === 'function' && define.amd ? define(['tslib', '@ts-ioc/core'], factory) :\n\t(global.aop = global.aop || {}, global.aop.umd = global.aop.umd || {}, global.aop.umd.js = factory(global.tslib,global['@ts-ioc/core']));\n}(this, (function (tslib_1,core_1) { 'use strict';\n\ntslib_1 = tslib_1 && tslib_1.hasOwnProperty('default') ? tslib_1['default'] : tslib_1;\ncore_1 = core_1 && core_1.hasOwnProperty('default') ? core_1['default'] : core_1;\n\nfunction unwrapExports (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar AopActions_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * aop actions.\n *\n * @export\n * @enum {number}\n */\nvar AopActions;\n(function (AopActions) {\n    /**\n     * register aspect service.\n     */\n    AopActions[\"registAspect\"] = \"registAspect\";\n    /**\n     * extends intstance.\n     */\n    AopActions[\"exetndsInstance\"] = \"exetndsInstance\";\n    /**\n     * match pointcut.\n     */\n    AopActions[\"matchPointcut\"] = \"matchPointcut\";\n    /**\n     * bind property pointcut.\n     */\n    AopActions[\"bindPropertyPointcut\"] = \"bindPropertyPointcut\";\n    /**\n     * bind method pointcut for instance.\n     */\n    AopActions[\"bindMethodPointcut\"] = \"bindMethodPointcut\";\n    AopActions[\"invokeBeforeConstructorAdvices\"] = \"invokeBeforeConstructorAdvices\";\n    AopActions[\"invokeAfterConstructorAdvices\"] = \"invokeAfterConstructorAdvices\";\n})(AopActions = exports.AopActions || (exports.AopActions = {}));\n\n\n});\n\nunwrapExports(AopActions_1);\nvar AopActions_2 = AopActions_1.AopActions;\n\nvar IAdvisor = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop IAdvisor interface token.\n * it is a token id, you can register yourself IAdvisor for this.\n */\nexports.AdvisorToken = new core_1.InjectToken('DI_IAdvisor');\n\n\n});\n\nunwrapExports(IAdvisor);\nvar IAdvisor_1 = IAdvisor.AdvisorToken;\n\nvar RegistAspectAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n/**\n * regist aspect action.\n *\n * @export\n * @class RegistAspectAction\n * @extends {ActionComposite}\n */\nvar RegistAspectAction = /** @class */ (function (_super) {\n    tslib_1.__extends(RegistAspectAction, _super);\n    function RegistAspectAction() {\n        return _super.call(this, AopActions_1.AopActions.registAspect) || this;\n    }\n    RegistAspectAction.prototype.working = function (container, data) {\n        var type = data.targetType;\n        var lifeScope = container.getLifeScope();\n        var matchs = lifeScope.getClassDecorators(type, function (surm) { return surm.actions.includes(AopActions_1.AopActions.registAspect) && core_1.hasOwnClassMetadata(surm.name, type); });\n        var aspectMgr = container.get(IAdvisor.AdvisorToken);\n        var raiseContainer = data.raiseContainer || container;\n        matchs.forEach(function (surm) {\n            var metadata = core_1.getOwnTypeMetadata(surm.name, type);\n            if (Array.isArray(metadata) && metadata.length > 0) {\n                metadata.forEach(function (meta) {\n                    if (core_1.isClass(meta.type)) {\n                        aspectMgr.add(meta.type, raiseContainer);\n                    }\n                });\n            }\n        });\n    };\n    RegistAspectAction.getClassAnnations = function () {\n        return { \"name\": \"RegistAspectAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    };\n    return RegistAspectAction;\n}(core_1.ActionComposite));\nexports.RegistAspectAction = RegistAspectAction;\n\n\n});\n\nunwrapExports(RegistAspectAction_1);\nvar RegistAspectAction_2 = RegistAspectAction_1.RegistAspectAction;\n\nvar NonePointcut = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * NonePointcut decorator, define class not work with aop.\n *\n * @NonePointcut\n */\nexports.NonePointcut = core_1.createClassDecorator('NonePointcut');\n\n\n});\n\nunwrapExports(NonePointcut);\nvar NonePointcut_1 = NonePointcut.NonePointcut;\n\nvar isValideAspectTarget_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n/**\n * is target can aspect or not.\n *\n * @export\n * @param {Type<any>} targetType\n * @returns {boolean}\n */\nfunction isValideAspectTarget(targetType) {\n    if (!core_1.isClass(targetType) || core_1.isBaseType(targetType)) {\n        return false;\n    }\n    if (core_1.hasOwnClassMetadata(NonePointcut.NonePointcut, targetType)) {\n        return false;\n    }\n    return true;\n}\nexports.isValideAspectTarget = isValideAspectTarget;\n\n\n});\n\nunwrapExports(isValideAspectTarget_1);\nvar isValideAspectTarget_2 = isValideAspectTarget_1.isValideAspectTarget;\n\nvar IAdvisorChainFactory = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop IAdvisorChainFactory interface token.\n * it is a token id, you can register yourself IAdvisorChainFactory for this.\n */\nexports.AdvisorChainFactoryToken = new core_1.InjectToken('DI_IAdvisorChainFactory');\n\n\n});\n\nunwrapExports(IAdvisorChainFactory);\nvar IAdvisorChainFactory_1 = IAdvisorChainFactory.AdvisorChainFactoryToken;\n\nvar JoinpointState_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar JoinpointState;\n(function (JoinpointState) {\n    JoinpointState[\"Before\"] = \"Before\";\n    JoinpointState[\"Pointcut\"] = \"Pointcut\";\n    JoinpointState[\"After\"] = \"After\";\n    JoinpointState[\"AfterReturning\"] = \"AfterReturning\";\n    JoinpointState[\"AfterThrowing\"] = \"AfterThrowing\";\n})(JoinpointState = exports.JoinpointState || (exports.JoinpointState = {}));\n\n\n});\n\nunwrapExports(JoinpointState_1);\nvar JoinpointState_2 = JoinpointState_1.JoinpointState;\n\nvar IJoinpoint = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n* Aop IJoinpoint interface token.\n* it is a token id, you can register yourself IJoinpoint for this.\n*/\nexports.JoinpointToken = new core_1.InjectToken('DI_IJoinpoint');\n\n\n});\n\nunwrapExports(IJoinpoint);\nvar IJoinpoint_1 = IJoinpoint.JoinpointToken;\n\nvar Joinpoint_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n/**\n * Join point data.\n *\n * @export\n * @class Joinpoint\n * @implements {IJoinpoint}\n */\nvar Joinpoint = /** @class */ (function () {\n    function Joinpoint(options) {\n        this.provJoinpoint = options.provJoinpoint;\n        this.name = options.name;\n        this.fullName = options.fullName;\n        this.params = options.params || [];\n        this.args = options.args;\n        this.returning = options.returning;\n        this.throwing = options.throwing;\n        this.state = options.state;\n        this.advicer = options.advicer;\n        this.annotations = options.annotations;\n        this.target = options.target;\n        this.targetType = options.targetType;\n    }\n    Joinpoint.getClassAnnations = function () {\n        return { \"name\": \"Joinpoint\", \"params\": { \"constructor\": [\"options\"] } };\n    };\n    Joinpoint = tslib_1.__decorate([\n        core_1.Injectable(IJoinpoint.JoinpointToken),\n        NonePointcut.NonePointcut(),\n        tslib_1.__metadata(\"design:paramtypes\", [Object])\n    ], Joinpoint);\n    return Joinpoint;\n}());\nexports.Joinpoint = Joinpoint;\n\n\n});\n\nunwrapExports(Joinpoint_1);\nvar Joinpoint_2 = Joinpoint_1.Joinpoint;\n\nvar joinpoints = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(JoinpointState_1, exports);\ntslib_1.__exportStar(IJoinpoint, exports);\ntslib_1.__exportStar(Joinpoint_1, exports);\n\n\n});\n\nunwrapExports(joinpoints);\n\nvar IAdvisorChain = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop IAdvisorChain interface token.\n * it is a token id, you can register yourself IAdvisorChain for this.\n */\nexports.AdvisorChainToken = new core_1.InjectToken('DI_IAdvisorChain');\n\n\n});\n\nunwrapExports(IAdvisorChain);\nvar IAdvisorChain_1 = IAdvisorChain.AdvisorChainToken;\n\nvar AdvisorChainFactory_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n\n/**\n * advisor chain factory.\n *\n * @export\n * @class AdvisorChainFactory\n * @implements {IAdvisorChainFactory}\n */\nvar AdvisorChainFactory = /** @class */ (function () {\n    function AdvisorChainFactory(container, advisor, advices) {\n        this.container = container;\n        this.advisor = advisor;\n        this.advices = advices;\n    }\n    AdvisorChainFactory.prototype.getAdvicers = function (adviceType) {\n        return (adviceType ? this.advices[adviceType] : null) || [];\n    };\n    AdvisorChainFactory.prototype.invoaction = function (joinPoint, state, valueOrthrowing) {\n        joinPoint.state = state;\n        joinPoint.returning = undefined;\n        joinPoint.throwing = undefined;\n        switch (state) {\n            case joinpoints.JoinpointState.Before:\n                this.before(joinPoint);\n                break;\n            case joinpoints.JoinpointState.Pointcut:\n                this.pointcut(joinPoint);\n                break;\n            case joinpoints.JoinpointState.After:\n                joinPoint.returning = valueOrthrowing;\n                this.after(joinPoint);\n                break;\n            case joinpoints.JoinpointState.AfterThrowing:\n                joinPoint.throwing = valueOrthrowing;\n                this.afterThrowing(joinPoint);\n                break;\n            case joinpoints.JoinpointState.AfterReturning:\n                joinPoint.returning = valueOrthrowing;\n                this.afterReturning(joinPoint);\n                break;\n        }\n    };\n    AdvisorChainFactory.prototype.before = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        this.getAdvicers('Around')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n        if (!core_1.isUndefined(cloneJp.args)) {\n            joinPoint.args = cloneJp.args;\n        }\n        this.getAdvicers('Before')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n    };\n    AdvisorChainFactory.prototype.pointcut = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        this.getAdvicers('Pointcut')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n        if (!core_1.isUndefined(cloneJp.args)) {\n            joinPoint.args = cloneJp.args;\n        }\n    };\n    AdvisorChainFactory.prototype.after = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        this.getAdvicers('Around')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n        this.getAdvicers('After')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n    };\n    AdvisorChainFactory.prototype.afterThrowing = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        this.getAdvicers('Around')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n        this.getAdvicers('AfterThrowing')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n    };\n    AdvisorChainFactory.prototype.afterReturning = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        var advChain = this.container.resolve(IAdvisorChain.AdvisorChainToken, { joinPoint: cloneJp });\n        this.getAdvicers('Around')\n            .forEach(function (advicer) {\n            advChain.next(function (jp) {\n                return _this.invokeAdvice(jp, advicer);\n            });\n        });\n        this.getAdvicers('AfterReturning')\n            .forEach(function (advicer) {\n            advChain.next(function (jp) {\n                return _this.invokeAdvice(jp, advicer);\n            });\n        });\n        advChain.next(function (jp) {\n            if (!core_1.isUndefined(jp.returning)) {\n                joinPoint.returning = jp.returning;\n            }\n            return joinPoint;\n        });\n        advChain.process();\n    };\n    AdvisorChainFactory.prototype.invokeAdvice = function (joinPoint, advicer) {\n        var _this = this;\n        var _a;\n        var providers = [];\n        providers.push(core_1.Provider.createExtends(joinpoints.Joinpoint, joinPoint, function (inst, provider) {\n            inst._cache_JoinPoint = provider.resolve(_this.container);\n        }));\n        var metadata = advicer.advice;\n        if (!core_1.isUndefined(joinPoint.args) && metadata.args) {\n            providers.push(core_1.Provider.create(metadata.args, joinPoint.args));\n        }\n        if (metadata.annotationArgName) {\n            providers.push(core_1.Provider.create(metadata.annotationArgName, function () {\n                var curj = joinPoint;\n                var annotations = curj.annotations;\n                while (!annotations && joinPoint.provJoinpoint) {\n                    curj = joinPoint.provJoinpoint;\n                    if (curj && curj.annotations) {\n                        annotations = curj.annotations;\n                        break;\n                    }\n                }\n                if (core_1.isArray(annotations)) {\n                    if (metadata.annotationName) {\n                        var d_1 = metadata.annotationName;\n                        d_1 = /^@/.test(d_1) ? d_1 : \"@\" + d_1;\n                        return annotations.filter(function (a) { return a.decorator === d_1; });\n                    }\n                    return annotations;\n                }\n                else {\n                    return [];\n                }\n            }));\n        }\n        if (!core_1.isUndefined(joinPoint.returning) && metadata.returning) {\n            providers.push(core_1.Provider.create(metadata.returning, joinPoint.returning));\n        }\n        if (!core_1.isUndefined(joinPoint.throwing) && metadata.throwing) {\n            providers.push(core_1.Provider.create(metadata.throwing, joinPoint.throwing));\n        }\n        return (_a = this.advisor.getContainer(advicer.aspectType, this.container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers));\n    };\n    AdvisorChainFactory.getClassAnnations = function () {\n        return { \"name\": \"AdvisorChainFactory\", \"params\": { \"constructor\": [\"container\", \"advisor\", \"advices\"], \"getAdvicers\": [\"adviceType\"], \"invoaction\": [\"joinPoint\", \"state\", \"valueOrthrowing\"], \"before\": [\"joinPoint\"], \"pointcut\": [\"joinPoint\"], \"after\": [\"joinPoint\"], \"afterThrowing\": [\"joinPoint\"], \"afterReturning\": [\"joinPoint\"], \"invokeAdvice\": [\"joinPoint\", \"advicer\"] } };\n    };\n    AdvisorChainFactory = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Injectable(IAdvisorChainFactory.AdvisorChainFactoryToken),\n        tslib_1.__param(0, core_1.Inject(core_1.ContainerToken)), tslib_1.__param(1, core_1.Inject(IAdvisor.AdvisorToken)),\n        tslib_1.__metadata(\"design:paramtypes\", [Object, Object, Object])\n    ], AdvisorChainFactory);\n    return AdvisorChainFactory;\n}());\nexports.AdvisorChainFactory = AdvisorChainFactory;\n\n\n});\n\nunwrapExports(AdvisorChainFactory_1);\nvar AdvisorChainFactory_2 = AdvisorChainFactory_1.AdvisorChainFactory;\n\nvar IAdvisorProceeding = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop IAdvisorProceeding interface token.\n * it is a token id, you can register yourself IAdvisorProceeding for this.\n */\nexports.AdvisorProceedingToken = new core_1.InjectToken('DI_IAdvisorProceeding');\n\n\n});\n\nunwrapExports(IAdvisorProceeding);\nvar IAdvisorProceeding_1 = IAdvisorProceeding.AdvisorProceedingToken;\n\nvar AdvisorChain_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n/**\n * advisor chain.\n *\n * @export\n * @class AdvisorChain\n * @implements {IAdvisorChain}\n */\nvar AdvisorChain = /** @class */ (function () {\n    function AdvisorChain(joinPoint) {\n        this.joinPoint = joinPoint;\n        this.actions = [];\n    }\n    /**\n     * register next action.\n     *\n     * @param {Express<Joinpoint, any>} action\n     * @memberof AdvisorChain\n     */\n    AdvisorChain.prototype.next = function (action) {\n        this.actions.push(action);\n    };\n    /**\n     * get recognizer of this advisor.\n     *\n     * @returns {IRecognizer}\n     * @memberof AdvisorChain\n     */\n    AdvisorChain.prototype.getRecognizer = function () {\n        return this.container.get(core_1.RecognizerToken, this.joinPoint.state);\n    };\n    /**\n     * process the advices.\n     *\n     * @memberof AdvisorChain\n     */\n    AdvisorChain.prototype.process = function () {\n        var _a;\n        var alias = this.getRecognizer().recognize(this.joinPoint.returning);\n        (_a = this.container.get(IAdvisorProceeding.AdvisorProceedingToken, alias)).proceeding.apply(_a, [this.joinPoint].concat(this.actions));\n    };\n    AdvisorChain.getClassAnnations = function () {\n        return { \"name\": \"AdvisorChain\", \"params\": { \"constructor\": [\"joinPoint\"], \"next\": [\"action\"], \"getRecognizer\": [], \"process\": [] } };\n    };\n    tslib_1.__decorate([\n        core_1.Inject(core_1.ContainerToken),\n        tslib_1.__metadata(\"design:type\", Object)\n    ], AdvisorChain.prototype, \"container\", void 0);\n    AdvisorChain = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Injectable(IAdvisorChain.AdvisorChainToken),\n        tslib_1.__metadata(\"design:paramtypes\", [joinpoints.Joinpoint])\n    ], AdvisorChain);\n    return AdvisorChain;\n}());\nexports.AdvisorChain = AdvisorChain;\n\n\n});\n\nunwrapExports(AdvisorChain_1);\nvar AdvisorChain_2 = AdvisorChain_1.AdvisorChain;\n\nvar IProxyMethod = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop proxy method interface token.\n * it is a token id, you can register yourself IProxyMethod for this.\n */\nexports.ProxyMethodToken = new core_1.InjectToken('DI_IProxyMethod');\n\n\n});\n\nunwrapExports(IProxyMethod);\nvar IProxyMethod_1 = IProxyMethod.ProxyMethodToken;\n\nvar ProxyMethod_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\nvar joinpoints_2 = joinpoints;\n\n\n\n\n/**\n * Proxy method.\n *\n * @export\n * @class ProxyMethod\n * @implements {IProxyMethod}\n */\nvar ProxyMethod = /** @class */ (function () {\n    function ProxyMethod(container) {\n        this.container = container;\n    }\n    Object.defineProperty(ProxyMethod.prototype, \"advisor\", {\n        get: function () {\n            if (!this._advisor) {\n                this._advisor = this.container.get(IAdvisor.AdvisorToken);\n            }\n            return this._advisor;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ProxyMethod.prototype, \"liefScope\", {\n        get: function () {\n            if (!this._liefScope) {\n                this._liefScope = this.container.getLifeScope();\n            }\n            return this._liefScope;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * proceed the proxy method.\n     *\n     * @param {*} target\n     * @param {Type<any>} targetType\n     * @param {IPointcut} pointcut\n     * @param {Joinpoint} [provJoinpoint]\n     * @memberof ProxyMethod\n     */\n    ProxyMethod.prototype.proceed = function (target, targetType, pointcut, provJoinpoint) {\n        var aspectMgr = this.advisor;\n        var fullName = pointcut.fullName;\n        var methodName = pointcut.name;\n        var advices = aspectMgr.getAdvices(fullName);\n        if (advices && pointcut) {\n            if (pointcut.descriptor && (pointcut.descriptor.get || pointcut.descriptor.set)) {\n                if (pointcut.descriptor.get) {\n                    var getMethod = pointcut.descriptor.get.bind(target);\n                    pointcut.descriptor.get = this.proxy(getMethod, advices, target, targetType, pointcut, provJoinpoint);\n                }\n                if (pointcut.descriptor.set) {\n                    var setMethod = pointcut.descriptor.set.bind(target);\n                    pointcut.descriptor.set = this.proxy(setMethod, advices, target, targetType, pointcut, provJoinpoint);\n                }\n                Object.defineProperty(target, methodName, pointcut.descriptor);\n            }\n            else if (core_1.isFunction(target[methodName])) {\n                var propertyMethod = target[methodName].bind(target);\n                target[methodName] = this.proxy(propertyMethod, advices, target, targetType, pointcut, provJoinpoint);\n            }\n        }\n    };\n    ProxyMethod.prototype.proxy = function (propertyMethod, advices, target, targetType, pointcut, provJoinpoint) {\n        var _this = this;\n        var fullName = pointcut.fullName;\n        var methodName = pointcut.name;\n        var liefScope = this.liefScope;\n        var container = this.container;\n        return function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            var joinPoint = _this.container.resolve(joinpoints_2.Joinpoint, core_1.Provider.create('options', {\n                name: methodName,\n                fullName: fullName,\n                provJoinpoint: provJoinpoint,\n                annotations: provJoinpoint ? null : liefScope.getMethodMetadatas(targetType, methodName),\n                params: liefScope.getMethodParameters(targetType, target, methodName),\n                args: args,\n                target: target,\n                targetType: targetType\n            }));\n            var adChain = container.resolve(IAdvisorChainFactory.AdvisorChainFactoryToken, { container: container, advisor: _this.advisor, advices: advices });\n            adChain.invoaction(joinPoint, joinpoints.JoinpointState.Before);\n            adChain.invoaction(joinPoint, joinpoints.JoinpointState.Pointcut);\n            var val, exeErr;\n            try {\n                val = propertyMethod.apply(void 0, joinPoint.args);\n            }\n            catch (err) {\n                exeErr = err;\n            }\n            adChain.invoaction(joinPoint, joinpoints.JoinpointState.After, val);\n            if (exeErr) {\n                adChain.invoaction(joinPoint, joinpoints.JoinpointState.AfterThrowing, exeErr);\n            }\n            else {\n                adChain.invoaction(joinPoint, joinpoints.JoinpointState.AfterReturning, val);\n                return joinPoint.returning;\n            }\n        };\n    };\n    ProxyMethod.getClassAnnations = function () {\n        return { \"name\": \"ProxyMethod\", \"params\": { \"constructor\": [\"container\"], \"proceed\": [\"target\", \"targetType\", \"pointcut\", \"provJoinpoint\"], \"proxy\": [\"propertyMethod\", \"advices\", \"target\", \"targetType\", \"pointcut\", \"provJoinpoint\"] } };\n    };\n    ProxyMethod = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Singleton(IProxyMethod.ProxyMethodToken),\n        tslib_1.__param(0, core_1.Inject(core_1.ContainerToken)),\n        tslib_1.__metadata(\"design:paramtypes\", [Object])\n    ], ProxyMethod);\n    return ProxyMethod;\n}());\nexports.ProxyMethod = ProxyMethod;\n\n\n});\n\nunwrapExports(ProxyMethod_1);\nvar ProxyMethod_2 = ProxyMethod_1.ProxyMethod;\n\nvar ReturningType_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Returning Type\n *\n * @export\n * @enum {number}\n */\nvar ReturningType;\n(function (ReturningType) {\n    /**\n     * it is a sync returning\n     */\n    ReturningType[\"sync\"] = \"sync\";\n    /**\n     * it is promise asyce returning\n     */\n    ReturningType[\"promise\"] = \"promise\";\n    /**\n     * it is observable asyce returning\n     */\n    ReturningType[\"observable\"] = \"observable\";\n})(ReturningType = exports.ReturningType || (exports.ReturningType = {}));\n\n\n});\n\nunwrapExports(ReturningType_1);\nvar ReturningType_2 = ReturningType_1.ReturningType;\n\nvar AsyncPromiseProceeding_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\nvar AsyncPromiseProceeding = /** @class */ (function () {\n    function AsyncPromiseProceeding() {\n    }\n    AsyncPromiseProceeding.prototype.proceeding = function (joinPoint) {\n        var actions = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            actions[_i - 1] = arguments[_i];\n        }\n        if (joinPoint.returning) {\n            actions.forEach((function (action) {\n                joinPoint.returning = joinPoint.returning.then(function (val) {\n                    joinPoint.returningValue = val;\n                    return Promise.resolve(action(joinPoint))\n                        .then(function () {\n                        return joinPoint.returningValue;\n                    });\n                });\n            }));\n        }\n    };\n    AsyncPromiseProceeding.getClassAnnations = function () {\n        return { \"name\": \"AsyncPromiseProceeding\", \"params\": { \"constructor\": [], \"proceeding\": [\"joinPoint\", \"actions\"] } };\n    };\n    AsyncPromiseProceeding = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Singleton(IAdvisorProceeding.AdvisorProceedingToken, ReturningType_1.ReturningType.promise),\n        tslib_1.__metadata(\"design:paramtypes\", [])\n    ], AsyncPromiseProceeding);\n    return AsyncPromiseProceeding;\n}());\nexports.AsyncPromiseProceeding = AsyncPromiseProceeding;\n\n\n});\n\nunwrapExports(AsyncPromiseProceeding_1);\nvar AsyncPromiseProceeding_2 = AsyncPromiseProceeding_1.AsyncPromiseProceeding;\n\nvar AsyncObservableProceeding_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\nvar AsyncObservableProceeding = /** @class */ (function () {\n    function AsyncObservableProceeding() {\n    }\n    AsyncObservableProceeding.prototype.proceeding = function (joinPoint) {\n        var actions = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            actions[_i - 1] = arguments[_i];\n        }\n        // if (isObservable(joinPoint.returning)) {\n        //     if (isFunction(joinPoint.returning.pipe)) {\n        //         const flatMap = require('rxjs/operators').flatMap;\n        //         actions.forEach(action => {\n        //             joinPoint.returning = joinPoint.returning.pipe(\n        //                 flatMap((val) => {\n        //                     joinPoint.returningValue = val;\n        //                     action(joinPoint);\n        //                     if (isObservable(joinPoint.returningValue)) {\n        //                         return joinPoint.returningValue;\n        //                     } else if (isPromise(joinPoint.returningValue)) {\n        //                         return joinPoint.returningValue;\n        //                     } else {\n        //                         return Promise.resolve(joinPoint.returningValue);\n        //                     }\n        //                 }));\n        //         });\n        //     } else\n        if (core_1.isObservable(joinPoint.returning) && core_1.isFunction(joinPoint.returning.flatMap)) {\n            actions.forEach(function (action) {\n                joinPoint.returning = joinPoint.returning.flatMap(function (val) {\n                    joinPoint.returningValue = val;\n                    action(joinPoint);\n                    if (core_1.isObservable(joinPoint.returningValue)) {\n                        return joinPoint.returningValue;\n                    }\n                    else if (core_1.isPromise(joinPoint.returningValue)) {\n                        return joinPoint.returningValue;\n                    }\n                    else {\n                        return Promise.resolve(joinPoint.returningValue);\n                    }\n                });\n            });\n        }\n        else {\n            actions.forEach(function (action) {\n                action(joinPoint);\n            });\n        }\n    };\n    AsyncObservableProceeding.getClassAnnations = function () {\n        return { \"name\": \"AsyncObservableProceeding\", \"params\": { \"constructor\": [], \"proceeding\": [\"joinPoint\", \"actions\"] } };\n    };\n    AsyncObservableProceeding = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Singleton(IAdvisorProceeding.AdvisorProceedingToken, ReturningType_1.ReturningType.observable),\n        tslib_1.__metadata(\"design:paramtypes\", [])\n    ], AsyncObservableProceeding);\n    return AsyncObservableProceeding;\n}());\nexports.AsyncObservableProceeding = AsyncObservableProceeding;\n\n\n});\n\nunwrapExports(AsyncObservableProceeding_1);\nvar AsyncObservableProceeding_2 = AsyncObservableProceeding_1.AsyncObservableProceeding;\n\nvar ReturningRecognizer_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\nvar ReturningRecognizer = /** @class */ (function () {\n    function ReturningRecognizer() {\n    }\n    ReturningRecognizer.prototype.recognize = function (value) {\n        if (core_1.isPromise(value)) {\n            return ReturningType_1.ReturningType.promise;\n        }\n        if (core_1.isObservable(value)) {\n            return ReturningType_1.ReturningType.observable;\n        }\n        return ReturningType_1.ReturningType.sync;\n    };\n    ReturningRecognizer.getClassAnnations = function () {\n        return { \"name\": \"ReturningRecognizer\", \"params\": { \"constructor\": [], \"recognize\": [\"value\"] } };\n    };\n    ReturningRecognizer = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Singleton(core_1.RecognizerToken, joinpoints.JoinpointState.AfterReturning),\n        tslib_1.__metadata(\"design:paramtypes\", [])\n    ], ReturningRecognizer);\n    return ReturningRecognizer;\n}());\nexports.ReturningRecognizer = ReturningRecognizer;\n\n\n});\n\nunwrapExports(ReturningRecognizer_1);\nvar ReturningRecognizer_2 = ReturningRecognizer_1.ReturningRecognizer;\n\nvar SyncProceeding_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\nvar SyncProceeding = /** @class */ (function () {\n    function SyncProceeding() {\n    }\n    SyncProceeding.prototype.proceeding = function (joinPoint) {\n        var actions = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            actions[_i - 1] = arguments[_i];\n        }\n        joinPoint.returningValue = joinPoint.returning;\n        actions.forEach((function (action) {\n            action(joinPoint);\n        }));\n    };\n    SyncProceeding.getClassAnnations = function () {\n        return { \"name\": \"SyncProceeding\", \"params\": { \"proceeding\": [\"joinPoint\", \"actions\"] } };\n    };\n    SyncProceeding = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Singleton(IAdvisorProceeding.AdvisorProceedingToken, ReturningType_1.ReturningType.sync)\n    ], SyncProceeding);\n    return SyncProceeding;\n}());\nexports.SyncProceeding = SyncProceeding;\n\n\n});\n\nunwrapExports(SyncProceeding_1);\nvar SyncProceeding_2 = SyncProceeding_1.SyncProceeding;\n\nvar access = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(IAdvisorChainFactory, exports);\ntslib_1.__exportStar(AdvisorChainFactory_1, exports);\ntslib_1.__exportStar(IAdvisorChain, exports);\ntslib_1.__exportStar(AdvisorChain_1, exports);\ntslib_1.__exportStar(IProxyMethod, exports);\ntslib_1.__exportStar(ProxyMethod_1, exports);\ntslib_1.__exportStar(AsyncPromiseProceeding_1, exports);\ntslib_1.__exportStar(AsyncObservableProceeding_1, exports);\ntslib_1.__exportStar(IAdvisorProceeding, exports);\ntslib_1.__exportStar(ReturningRecognizer_1, exports);\ntslib_1.__exportStar(ReturningType_1, exports);\ntslib_1.__exportStar(SyncProceeding_1, exports);\n\n\n});\n\nunwrapExports(access);\n\nvar BindMethodPointcutAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n/**\n * bind method pointcut action.\n *\n * @export\n * @class BindMethodPointcutAction\n * @extends {ActionComposite}\n */\nvar BindMethodPointcutAction = /** @class */ (function (_super) {\n    tslib_1.__extends(BindMethodPointcutAction, _super);\n    function BindMethodPointcutAction() {\n        return _super.call(this, AopActions_1.AopActions.bindMethodPointcut) || this;\n    }\n    BindMethodPointcutAction.prototype.working = function (container, data) {\n        // aspect class do nothing.\n        if (!data.target || !isValideAspectTarget_1.isValideAspectTarget(data.targetType)) {\n            return;\n        }\n        if (!container.hasRegister(access.ProxyMethodToken)) {\n            return;\n        }\n        var proxy = container.get(access.ProxyMethodToken);\n        var target = data.target;\n        var targetType = data.targetType;\n        var className = core_1.lang.getClassName(targetType);\n        var methods = [];\n        var decorators = Object.getOwnPropertyDescriptors(targetType.prototype);\n        core_1.lang.forIn(decorators, function (item, name) {\n            if (name === 'constructor') {\n                return;\n            }\n            methods.push({\n                name: name,\n                fullName: className + \".\" + name,\n                descriptor: item\n            });\n        });\n        var allmethods = core_1.getParamerterNames(targetType);\n        core_1.lang.forIn(allmethods, function (item, name) {\n            if (name === 'constructor') {\n                return;\n            }\n            if (core_1.isUndefined(decorators[name])) {\n                methods.push({\n                    name: name,\n                    fullName: className + \".\" + name\n                });\n            }\n        });\n        methods.forEach(function (pointcut) {\n            proxy.proceed(target, targetType, pointcut, target['_cache_JoinPoint']);\n        });\n    };\n    BindMethodPointcutAction.getClassAnnations = function () {\n        return { \"name\": \"BindMethodPointcutAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    };\n    return BindMethodPointcutAction;\n}(core_1.ActionComposite));\nexports.BindMethodPointcutAction = BindMethodPointcutAction;\n\n\n});\n\nunwrapExports(BindMethodPointcutAction_1);\nvar BindMethodPointcutAction_2 = BindMethodPointcutAction_1.BindMethodPointcutAction;\n\nvar InvokeBeforeConstructorAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n/**\n * actions invoke before constructor.\n *\n * @export\n * @class InvokeBeforeConstructorAction\n * @extends {ActionComposite}\n */\nvar InvokeBeforeConstructorAction = /** @class */ (function (_super) {\n    tslib_1.__extends(InvokeBeforeConstructorAction, _super);\n    function InvokeBeforeConstructorAction() {\n        return _super.call(this, AopActions_1.AopActions.registAspect) || this;\n    }\n    InvokeBeforeConstructorAction.prototype.working = function (container, data) {\n        // aspect class do nothing.\n        if (!isValideAspectTarget_1.isValideAspectTarget(data.targetType)) {\n            return;\n        }\n        var advisor = container.get(IAdvisor.AdvisorToken);\n        var className = core_1.lang.getClassName(data.targetType);\n        var advices = advisor.getAdvices(className + '.constructor');\n        if (!advices) {\n            return;\n        }\n        var targetType = data.targetType;\n        var target = data.target;\n        var joinPoint = container.resolve(joinpoints.Joinpoint, core_1.Provider.create('options', {\n            name: 'constructor',\n            state: joinpoints.JoinpointState.Before,\n            fullName: className + '.constructor',\n            target: target,\n            args: data.args,\n            params: data.params,\n            targetType: targetType\n        }));\n        var providers = [core_1.Provider.create(joinpoints.Joinpoint, joinPoint)];\n        if (data.providerMap) {\n            providers.push(data.providerMap);\n        }\n        advices.Before.forEach(function (advicer) {\n            var _a;\n            (_a = advisor.getContainer(advicer.aspectType, container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers)); // new Joinpoint(joinPoint) // container.resolve(Joinpoint, { json: joinPoint })\n        });\n        advices.Around.forEach(function (advicer) {\n            var _a;\n            (_a = advisor.getContainer(advicer.aspectType, container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers));\n        });\n    };\n    InvokeBeforeConstructorAction.getClassAnnations = function () {\n        return { \"name\": \"InvokeBeforeConstructorAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    };\n    return InvokeBeforeConstructorAction;\n}(core_1.ActionComposite));\nexports.InvokeBeforeConstructorAction = InvokeBeforeConstructorAction;\n\n\n});\n\nunwrapExports(InvokeBeforeConstructorAction_1);\nvar InvokeBeforeConstructorAction_2 = InvokeBeforeConstructorAction_1.InvokeBeforeConstructorAction;\n\nvar InvokeAfterConstructorAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n/**\n * invoke after constructor action.\n *\n * @export\n * @class InvokeAfterConstructorAction\n * @extends {ActionComposite}\n */\nvar InvokeAfterConstructorAction = /** @class */ (function (_super) {\n    tslib_1.__extends(InvokeAfterConstructorAction, _super);\n    function InvokeAfterConstructorAction() {\n        return _super.call(this, AopActions_1.AopActions.invokeAfterConstructorAdvices) || this;\n    }\n    InvokeAfterConstructorAction.prototype.working = function (container, data) {\n        // aspect class do nothing.\n        if (!data.target || !isValideAspectTarget_1.isValideAspectTarget(data.targetType)) {\n            return;\n        }\n        var advisor = container.get(IAdvisor.AdvisorToken);\n        var className = core_1.lang.getClassName(data.targetType);\n        var advices = advisor.getAdvices(className + '.constructor');\n        if (!advices) {\n            return;\n        }\n        var targetType = data.targetType;\n        var target = data.target;\n        var joinPoint = container.resolve(joinpoints.Joinpoint, core_1.Provider.create('options', {\n            name: 'constructor',\n            state: joinpoints.JoinpointState.After,\n            fullName: className + '.constructor',\n            target: target,\n            args: data.args,\n            params: data.params,\n            targetType: targetType\n        }));\n        var providers = [core_1.Provider.create(joinpoints.Joinpoint, joinPoint)];\n        if (data.providerMap) {\n            providers.push(data.providerMap);\n        }\n        advices.After.forEach(function (advicer) {\n            var _a;\n            (_a = advisor.getContainer(advicer.aspectType, container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers));\n        });\n        advices.Around.forEach(function (advicer) {\n            var _a;\n            (_a = advisor.getContainer(advicer.aspectType, container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers));\n        });\n    };\n    InvokeAfterConstructorAction.getClassAnnations = function () {\n        return { \"name\": \"InvokeAfterConstructorAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    };\n    return InvokeAfterConstructorAction;\n}(core_1.ActionComposite));\nexports.InvokeAfterConstructorAction = InvokeAfterConstructorAction;\n\n\n});\n\nunwrapExports(InvokeAfterConstructorAction_1);\nvar InvokeAfterConstructorAction_2 = InvokeAfterConstructorAction_1.InvokeAfterConstructorAction;\n\nvar IAdviceMatcher = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop advice matcher interface token.\n * it is a token id, you can register yourself IActionBuilder for this.\n */\nexports.AdviceMatcherToken = new core_1.InjectToken('DI_IAdviceMatcher');\n\n\n});\n\nunwrapExports(IAdviceMatcher);\nvar IAdviceMatcher_1 = IAdviceMatcher.AdviceMatcherToken;\n\nvar MatchPointcutAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n/**\n *  match pointcut action.\n *\n * @export\n * @class MatchPointcutAction\n * @extends {ActionComposite}\n */\nvar MatchPointcutAction = /** @class */ (function (_super) {\n    tslib_1.__extends(MatchPointcutAction, _super);\n    function MatchPointcutAction() {\n        return _super.call(this, AopActions_1.AopActions.matchPointcut) || this;\n    }\n    MatchPointcutAction.prototype.working = function (container, data) {\n        var _this = this;\n        // aspect class do nothing.\n        if (!isValideAspectTarget_1.isValideAspectTarget(data.targetType)) {\n            return;\n        }\n        var advisor = container.get(IAdvisor.AdvisorToken);\n        var matcher = container.get(IAdviceMatcher.AdviceMatcherToken);\n        advisor.aspects.forEach(function (adviceMetas, type) {\n            var matchpoints = matcher.match(type, data.targetType, adviceMetas, data.target);\n            matchpoints.forEach(function (mpt) {\n                var fullName = mpt.fullName;\n                var advice = mpt.advice;\n                var advices = advisor.getAdvices(fullName);\n                if (!advices) {\n                    advices = {\n                        Before: [],\n                        Pointcut: [],\n                        After: [],\n                        Around: [],\n                        AfterThrowing: [],\n                        AfterReturning: []\n                    };\n                    advisor.setAdvices(fullName, advices);\n                }\n                var advicer = core_1.lang.assign(mpt, {\n                    aspectType: type\n                });\n                if (advice.adviceName === 'Before') {\n                    if (!advices.Before.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.Before.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'Pointcut') {\n                    if (!advices.Pointcut.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.Pointcut.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'Around') {\n                    if (!advices.Around.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.Around.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'After') {\n                    if (!advices.After.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.After.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'AfterThrowing') {\n                    if (!advices.AfterThrowing.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.AfterThrowing.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'AfterReturning') {\n                    if (!advices.AfterReturning.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.AfterReturning.push(advicer);\n                    }\n                }\n            });\n        });\n    };\n    MatchPointcutAction.prototype.isAdviceEquals = function (advice1, advice2) {\n        if (!advice1 || !advice2) {\n            return false;\n        }\n        if (advice1 === advice2) {\n            return true;\n        }\n        return advice1.adviceName === advice2.adviceName\n            && advice1.pointcut === advice2.pointcut\n            && advice1.propertyKey === advice2.propertyKey;\n    };\n    MatchPointcutAction.getClassAnnations = function () {\n        return { \"name\": \"MatchPointcutAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"], \"isAdviceEquals\": [\"advice1\", \"advice2\"] } };\n    };\n    return MatchPointcutAction;\n}(core_1.ActionComposite));\nexports.MatchPointcutAction = MatchPointcutAction;\n\n\n});\n\nunwrapExports(MatchPointcutAction_1);\nvar MatchPointcutAction_2 = MatchPointcutAction_1.MatchPointcutAction;\n\nvar ExetndsInstanceAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n/**\n * extends instance action.\n *\n * @export\n * @class ExetndsInstanceAction\n * @extends {ActionComposite}\n */\nvar ExetndsInstanceAction = /** @class */ (function (_super) {\n    tslib_1.__extends(ExetndsInstanceAction, _super);\n    function ExetndsInstanceAction() {\n        return _super.call(this, AopActions_1.AopActions.registAspect) || this;\n    }\n    ExetndsInstanceAction.prototype.working = function (container, data) {\n        // aspect class do nothing.\n        if (!data.target || !data.providers || data.providers.length < 1) {\n            return;\n        }\n        data.providers.forEach(function (p) {\n            if (p && p instanceof core_1.ExtendsProvider) {\n                p.extends(data.target);\n            }\n        });\n    };\n    ExetndsInstanceAction.getClassAnnations = function () {\n        return { \"name\": \"ExetndsInstanceAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    };\n    return ExetndsInstanceAction;\n}(core_1.ActionComposite));\nexports.ExetndsInstanceAction = ExetndsInstanceAction;\n\n\n});\n\nunwrapExports(ExetndsInstanceAction_1);\nvar ExetndsInstanceAction_2 = ExetndsInstanceAction_1.ExetndsInstanceAction;\n\nvar AopActionFactory_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n\n/**\n * aop action factory.\n *\n * @export\n * @class AopActionFactory\n */\nvar AopActionFactory = /** @class */ (function () {\n    function AopActionFactory() {\n    }\n    /**\n     * create aop decorator action component.\n     *\n     * @param {string} type\n     * @returns {ActionComponent}\n     * @memberof AopActionFactory\n     */\n    AopActionFactory.prototype.create = function (type) {\n        var action;\n        switch (type) {\n            case AopActions_1.AopActions.registAspect:\n                action = new RegistAspectAction_1.RegistAspectAction();\n                break;\n            case AopActions_1.AopActions.matchPointcut:\n                action = new MatchPointcutAction_1.MatchPointcutAction();\n                break;\n            case AopActions_1.AopActions.invokeBeforeConstructorAdvices:\n                action = new InvokeBeforeConstructorAction_1.InvokeBeforeConstructorAction();\n                break;\n            case AopActions_1.AopActions.invokeAfterConstructorAdvices:\n                action = new InvokeAfterConstructorAction_1.InvokeAfterConstructorAction();\n                break;\n            case AopActions_1.AopActions.bindMethodPointcut:\n                action = new BindMethodPointcutAction_1.BindMethodPointcutAction();\n                break;\n            // case AopActions.bindPropertyPointcut:\n            //     action = new BindPropertyPointcutAction();\n            //     break;\n            case AopActions_1.AopActions.exetndsInstance:\n                action = new ExetndsInstanceAction_1.ExetndsInstanceAction();\n                break;\n        }\n        return action;\n    };\n    AopActionFactory.getClassAnnations = function () {\n        return { \"name\": \"AopActionFactory\", \"params\": { \"create\": [\"type\"] } };\n    };\n    return AopActionFactory;\n}());\nexports.AopActionFactory = AopActionFactory;\n\n\n});\n\nunwrapExports(AopActionFactory_1);\nvar AopActionFactory_2 = AopActionFactory_1.AopActionFactory;\n\nvar actions = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(AopActions_1, exports);\ntslib_1.__exportStar(RegistAspectAction_1, exports);\ntslib_1.__exportStar(BindMethodPointcutAction_1, exports);\ntslib_1.__exportStar(InvokeBeforeConstructorAction_1, exports);\ntslib_1.__exportStar(InvokeAfterConstructorAction_1, exports);\n// export * from './BindPropertyPointcutAction';\ntslib_1.__exportStar(MatchPointcutAction_1, exports);\ntslib_1.__exportStar(AopActionFactory_1, exports);\ntslib_1.__exportStar(ExetndsInstanceAction_1, exports);\n\n\n});\n\nunwrapExports(actions);\n\nvar Advice = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\nfunction createAdviceDecorator(adviceName, adapter, afterPointcutAdapter, metadataExtends) {\n    return core_1.createMethodDecorator('Advice', function (args) {\n        if (adapter) {\n            adapter(args);\n        }\n        args.next({\n            match: function (arg) { return core_1.isString(arg) || core_1.isRegExp(arg); },\n            setMetadata: function (metadata, arg) {\n                metadata.pointcut = arg;\n            }\n        });\n        if (afterPointcutAdapter) {\n            afterPointcutAdapter(args);\n        }\n        args.next({\n            match: function (arg) { return core_1.isString(arg); },\n            setMetadata: function (metadata, arg) {\n                metadata.annotationArgName = arg;\n            }\n        });\n        args.next({\n            match: function (arg) { return core_1.isString(arg); },\n            setMetadata: function (metadata, arg) {\n                metadata.annotationName = arg;\n            }\n        });\n    }, function (metadata) {\n        if (metadataExtends) {\n            metadataExtends(metadata);\n        }\n        metadata.adviceName = adviceName;\n        return metadata;\n    });\n}\nexports.createAdviceDecorator = createAdviceDecorator;\n/**\n * aop advice decorator.\n *\n * @Advice\n */\nexports.Advice = createAdviceDecorator('Advice');\n\n\n});\n\nunwrapExports(Advice);\nvar Advice_1 = Advice.createAdviceDecorator;\nvar Advice_2 = Advice.Advice;\n\nvar Aspect = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aspect decorator. define aspect service.\n *\n * @Aspect\n */\nexports.Aspect = core_1.createClassDecorator('Aspect', function (args) {\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.annotation = arg;\n        }\n    });\n    args.next({\n        match: function (arg) { return core_1.isArray(arg) || core_1.isClass(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.within = arg;\n        }\n    });\n});\n\n\n});\n\nunwrapExports(Aspect);\nvar Aspect_1 = Aspect.Aspect;\n\nvar After = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * aop after advice decorator.\n *\n * @After\n */\nexports.After = Advice.createAdviceDecorator('After');\n\n\n});\n\nunwrapExports(After);\nvar After_1 = After.After;\n\nvar AfterReturning = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n/**\n * aop after returning advice decorator.\n *\n * @AfterReturning\n */\nexports.AfterReturning = Advice.createAdviceDecorator('AfterReturning', null, function (args) {\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.returning = arg;\n        }\n    });\n});\n\n\n});\n\nunwrapExports(AfterReturning);\nvar AfterReturning_1 = AfterReturning.AfterReturning;\n\nvar AfterThrowing = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n/**\n * aop after throwing advice decorator.\n *\n * @AfterThrowing\n */\nexports.AfterThrowing = Advice.createAdviceDecorator('AfterThrowing', null, function (args) {\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.throwing = arg;\n        }\n    });\n});\n\n\n});\n\nunwrapExports(AfterThrowing);\nvar AfterThrowing_1 = AfterThrowing.AfterThrowing;\n\nvar Around = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n/**\n * aop Around advice decorator.\n *\n * @Around\n */\nexports.Around = Advice.createAdviceDecorator('Around', null, function (args) {\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.args = arg;\n        }\n    });\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.returning = arg;\n        }\n    });\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.throwing = arg;\n        }\n    });\n});\n\n\n});\n\nunwrapExports(Around);\nvar Around_1 = Around.Around;\n\nvar Before = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * aop Before advice decorator.\n *\n * @Before\n */\nexports.Before = Advice.createAdviceDecorator('Before');\n\n\n});\n\nunwrapExports(Before);\nvar Before_1 = Before.Before;\n\nvar Pointcut = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * aop Pointcut advice decorator.\n *\n * @Pointcut\n */\nexports.Pointcut = Advice.createAdviceDecorator('Pointcut');\n\n\n});\n\nunwrapExports(Pointcut);\nvar Pointcut_1 = Pointcut.Pointcut;\n\nvar decorators = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(Advice, exports);\ntslib_1.__exportStar(Aspect, exports);\ntslib_1.__exportStar(After, exports);\ntslib_1.__exportStar(AfterReturning, exports);\ntslib_1.__exportStar(AfterThrowing, exports);\ntslib_1.__exportStar(Around, exports);\ntslib_1.__exportStar(Before, exports);\ntslib_1.__exportStar(Pointcut, exports);\ntslib_1.__exportStar(NonePointcut, exports);\n\n\n});\n\nunwrapExports(decorators);\n\nvar Advisor_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n/**\n * for global aop advisor.\n *\n * @export\n * @class Advisor\n */\nvar Advisor = /** @class */ (function () {\n    function Advisor() {\n        this.aspects = new Map();\n        this.aspectIocs = new Map();\n        this.advices = new Map();\n    }\n    /**\n     * set advices.\n     *\n     * @param {string} key\n     * @param {Advices} advices\n     * @memberof Advisor\n     */\n    Advisor.prototype.setAdvices = function (key, advices) {\n        if (!this.advices.has(key)) {\n            this.advices.set(key, advices);\n        }\n    };\n    /**\n     * get advices.\n     *\n     * @param {string} key\n     * @returns\n     * @memberof Advisor\n     */\n    Advisor.prototype.getAdvices = function (key) {\n        if (!this.advices.has(key)) {\n            return null;\n        }\n        return this.advices.get(key);\n    };\n    /**\n     * has register advices or not.\n     *\n     * @param {Type<any>} targetType\n     * @returns {boolean}\n     * @memberof Advisor\n     */\n    Advisor.prototype.hasRegisterAdvices = function (targetType) {\n        var _this = this;\n        var methods = core_1.lang.keys(Object.getOwnPropertyDescriptors(targetType.prototype));\n        var className = core_1.lang.getClassName(targetType);\n        return methods.some(function (m) { return _this.advices.has(className + \".\" + m); });\n    };\n    /**\n     * add aspect.\n     *\n     * @param {Type<any>} aspect\n     * @param {IContainer} raiseContainer\n     * @memberof Advisor\n     */\n    Advisor.prototype.add = function (aspect, raiseContainer) {\n        if (!this.aspects.has(aspect)) {\n            var metas = core_1.getOwnMethodMetadata(Advice.Advice, aspect);\n            this.aspects.set(aspect, metas);\n            this.aspectIocs.set(aspect, raiseContainer);\n        }\n    };\n    Advisor.prototype.getContainer = function (aspect, defaultContainer) {\n        if (this.aspectIocs.has(aspect)) {\n            return this.aspectIocs.get(aspect) || defaultContainer;\n        }\n        return defaultContainer;\n    };\n    /**\n     * resolve aspect.\n     *\n     * @template T\n     * @param {Type<T>} aspect\n     * @param {...ParamProviders[]} providers\n     * @returns {T}\n     * @memberof Advisor\n     */\n    Advisor.prototype.resolve = function (aspect) {\n        var providers = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            providers[_i - 1] = arguments[_i];\n        }\n        var _a;\n        if (this.aspectIocs.has(aspect)) {\n            return (_a = this.aspectIocs.get(aspect)).resolve.apply(_a, [aspect].concat(providers));\n        }\n        return null;\n    };\n    Advisor.getClassAnnations = function () {\n        return { \"name\": \"Advisor\", \"params\": { \"constructor\": [], \"setAdvices\": [\"key\", \"advices\"], \"getAdvices\": [\"key\"], \"hasRegisterAdvices\": [\"targetType\"], \"add\": [\"aspect\", \"raiseContainer\"], \"getContainer\": [\"aspect\", \"defaultContainer\"], \"resolve\": [\"aspect\", \"providers\"] } };\n    };\n    Advisor = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Singleton(IAdvisor.AdvisorToken),\n        tslib_1.__metadata(\"design:paramtypes\", [])\n    ], Advisor);\n    return Advisor;\n}());\nexports.Advisor = Advisor;\n\n\n});\n\nunwrapExports(Advisor_1);\nvar Advisor_2 = Advisor_1.Advisor;\n\nvar AdviceMatcher_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n/**\n * advice matcher, use to match advice when a registered create instance.\n *\n * @export\n * @class AdviceMatcher\n * @implements {IAdviceMatcher}\n */\nvar AdviceMatcher = /** @class */ (function () {\n    function AdviceMatcher(container) {\n        this.container = container;\n    }\n    AdviceMatcher.prototype.match = function (aspectType, targetType, adviceMetas, target) {\n        var _this = this;\n        var aspectMeta = core_1.lang.first(core_1.getOwnTypeMetadata(Aspect.Aspect, aspectType));\n        if (aspectMeta) {\n            if (aspectMeta.within) {\n                var ins = core_1.isArray(aspectMeta.within) ? aspectMeta.within : [aspectMeta.within];\n                if (ins.indexOf(targetType) < 0) {\n                    return [];\n                }\n            }\n            if (aspectMeta.annotation) {\n                var annotation = core_1.isFunction(aspectMeta.annotation) ? aspectMeta.annotation.toString() : aspectMeta.annotation;\n                var anno = (/^\\^?@\\w+/.test(annotation) ? '' : '@') + annotation;\n                if (!core_1.hasOwnClassMetadata(anno, targetType)) {\n                    return [];\n                }\n            }\n        }\n        var className = core_1.lang.getClassName(targetType);\n        adviceMetas = adviceMetas || core_1.getOwnMethodMetadata(Advice.Advice, targetType);\n        var matched = [];\n        if (targetType === aspectType) {\n            var adviceNames = core_1.lang.keys(adviceMetas);\n            if (adviceNames.length > 1) {\n                var advices_1 = [];\n                adviceNames.forEach(function (n) {\n                    advices_1 = advices_1.concat(adviceMetas[n]);\n                });\n                adviceNames.forEach(function (n) {\n                    advices_1.forEach(function (adv) {\n                        if (adv.propertyKey !== n) {\n                            if (_this.matchAspectSelf(n, adv)) {\n                                matched.push({\n                                    name: n,\n                                    fullName: className + \".\" + n,\n                                    advice: adv\n                                });\n                            }\n                        }\n                    });\n                });\n            }\n        }\n        else {\n            var points_1 = [];\n            var decorators_1 = Object.getOwnPropertyDescriptors(targetType.prototype);\n            // match method.\n            for (var name_1 in decorators_1) {\n                points_1.push({\n                    name: name_1,\n                    fullName: className + \".\" + name_1\n                });\n            }\n            var allmethods = core_1.getParamerterNames(targetType);\n            core_1.lang.forIn(allmethods, function (item, name) {\n                if (name === 'constructor') {\n                    return;\n                }\n                if (core_1.isUndefined(decorators_1[name])) {\n                    points_1.push({\n                        name: name,\n                        fullName: className + \".\" + name\n                    });\n                }\n            });\n            Object.getOwnPropertyNames(adviceMetas).forEach(function (name) {\n                var advices = adviceMetas[name];\n                advices.forEach(function (metadata) {\n                    matched = matched.concat(_this.filterPointcut(targetType, points_1, metadata));\n                });\n            });\n        }\n        return matched;\n    };\n    AdviceMatcher.prototype.matchAspectSelf = function (name, metadata) {\n        if (metadata.pointcut) {\n            var pointcut = metadata.pointcut;\n            if (core_1.isString(pointcut)) {\n                if (/^execution\\(\\S+\\)$/.test(pointcut)) {\n                    pointcut = pointcut.substring(10, pointcut.length - 1);\n                }\n                return pointcut.startsWith(name);\n            }\n            else if (core_1.isRegExp(pointcut)) {\n                return pointcut.test(name);\n            }\n        }\n        return false;\n    };\n    AdviceMatcher.prototype.filterPointcut = function (type, points, metadata, target) {\n        if (!metadata.pointcut) {\n            return [];\n        }\n        var matchedPointcut;\n        if (metadata.pointcut) {\n            var match_1 = this.matchTypeFactory(type, metadata);\n            matchedPointcut = points.filter(function (p) { return match_1(p.name, p.fullName, type, target, p); });\n        }\n        matchedPointcut = matchedPointcut || [];\n        return matchedPointcut.map(function (p) {\n            return core_1.lang.assign({}, p, { advice: metadata });\n        });\n    };\n    AdviceMatcher.prototype.matchTypeFactory = function (type, metadata) {\n        var pointcut = metadata.pointcut;\n        var expresses = [];\n        if (metadata.within) {\n            expresses.push(function (method, fullName, targetType) {\n                if (core_1.isArray(metadata.within)) {\n                    return metadata.within.indexOf(targetType) >= 0;\n                }\n                else {\n                    return metadata.within === targetType;\n                }\n            });\n            expresses.push('&&');\n        }\n        if (metadata.target) {\n            expresses.push(function (method, fullName, targetType, target) {\n                return metadata.target = target;\n            });\n            expresses.push('&&');\n        }\n        if (metadata.annotation) {\n            expresses.push(function (method, fullName, targetType, target) {\n                return core_1.hasOwnMethodMetadata(metadata.annotation, targetType, method);\n            });\n            expresses.push('&&');\n        }\n        if (core_1.isString(pointcut)) {\n            var pointcuts = (pointcut || '').trim();\n            expresses.push(this.tranlateExpress(type, pointcuts));\n        }\n        else if (core_1.isRegExp(pointcut)) {\n            var pointcutReg_1 = pointcut;\n            if (/^\\^?@\\w+/.test(pointcutReg_1.source)) {\n                expresses.push(function (name, fullName, targetType) {\n                    var decName = Reflect.getMetadataKeys(type, name);\n                    return decName.some(function (n) { return core_1.isString(n) && pointcutReg_1.test(n); });\n                });\n            }\n            else {\n                expresses.push(function (name, fullName) { return pointcutReg_1.test(fullName); });\n            }\n        }\n        return this.mergeExpress.apply(this, expresses);\n    };\n    AdviceMatcher.prototype.spiltBrace = function (strExp) {\n        strExp = strExp.trim();\n        if (/^\\(/.test(strExp) && /\\)$/.test(strExp)) {\n            strExp = strExp.substring(1, strExp.length - 1).trim();\n        }\n        if (/^\\(/.test(strExp) && /\\)$/.test(strExp)) {\n            return this.spiltBrace(strExp);\n        }\n        else {\n            return strExp;\n        }\n    };\n    AdviceMatcher.prototype.expressToFunc = function (type, strExp) {\n        var _this = this;\n        if (/^@annotation\\(.*\\)$/.test(strExp)) {\n            var exp = strExp.substring(12, strExp.length - 1);\n            var annotation_1 = /^@/.test(exp) ? exp : ('@' + exp);\n            return function (name, fullName) { return core_1.hasOwnMethodMetadata(annotation_1, type, name) && !core_1.hasOwnClassMetadata(Aspect.Aspect, type); };\n        }\n        else if (/^execution\\(.*\\)$/.test(strExp)) {\n            var exp = strExp.substring(10, strExp.length - 1);\n            if (exp === '*' || exp === '*.*') {\n                return function (name, fullName) { return !!name && !core_1.hasOwnClassMetadata(Aspect.Aspect, type); };\n            }\n            else if (/^\\w+(\\((\\s*\\w+\\s*,)*\\s*\\w*\\))?$/.test(exp)) {\n                // if is method name, will match aspect self only.\n                return function () { return false; };\n            }\n            else if (/^([\\w\\*]+\\.)+[\\w\\*]+(\\((\\s*\\w+\\s*,)*\\s*\\w*\\))?$/.test(exp)) {\n                exp = exp.replace(/\\*\\*/gi, '(\\\\\\w+(\\\\\\.|\\\\\\/)){0,}\\\\\\w+')\n                    .replace(/\\*/gi, '\\\\\\w+')\n                    .replace(/\\./gi, '\\\\\\.')\n                    .replace(/\\//gi, '\\\\\\/');\n                var matcher_1 = new RegExp(exp + \"$\");\n                return function (name, fullName) { return matcher_1.test(fullName); };\n            }\n            else {\n                return function () { return false; };\n            }\n        }\n        else if (/^@within\\(\\s*\\w+/.test(strExp)) {\n            var classnames_1 = strExp.substring(strExp.indexOf('(') + 1, strExp.length - 1).split(',').map(function (n) { return n.trim(); });\n            return function (name, fullName, targetType) { return classnames_1.indexOf(core_1.lang.getClassName(targetType)) >= 0; };\n        }\n        else if (/^@target\\(\\s*\\w+/.test(strExp)) {\n            var torken_1 = strExp.substring(strExp.indexOf('(') + 1, strExp.length - 1).trim();\n            return function (name, fullName, targetType) { return _this.container.getTokenImpl(torken_1) === targetType; };\n        }\n        else {\n            return function () { return false; };\n        }\n    };\n    AdviceMatcher.prototype.tranlateExpress = function (type, strExp) {\n        var expresses = [];\n        var idxOr = strExp.indexOf('||');\n        var idxAd = strExp.indexOf('&&');\n        if (idxAd < 0 && idxOr < 0) {\n            expresses.push(this.expressToFunc(type, this.spiltBrace(strExp)));\n        }\n        else {\n            if (idxOr > idxAd) {\n                var leftExp = this.spiltBrace(strExp.substring(0, idxOr));\n                if (leftExp) {\n                    expresses.push(this.tranlateExpress(type, leftExp));\n                }\n                var rightExp = this.spiltBrace(strExp.substring(idxOr + 2));\n                if (rightExp) {\n                    expresses.push('||');\n                    expresses.push(this.tranlateExpress(type, rightExp));\n                }\n            }\n            else if (idxAd > idxOr) {\n                var leftExp = this.spiltBrace(strExp.substring(0, idxAd));\n                if (leftExp) {\n                    expresses.push(this.tranlateExpress(type, leftExp));\n                }\n                var rightExp = this.spiltBrace(strExp.substring(idxAd + 2));\n                if (rightExp) {\n                    expresses.push('&&');\n                    expresses.push(this.tranlateExpress(type, rightExp));\n                }\n            }\n        }\n        return this.mergeExpress.apply(this, expresses);\n    };\n    AdviceMatcher.prototype.mergeExpress = function () {\n        var expresses = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            expresses[_i] = arguments[_i];\n        }\n        return function (method, fullName, targetType, pointcut) {\n            var flag;\n            expresses.forEach(function (express, idx) {\n                if (!core_1.isUndefined(flag)) {\n                    return;\n                }\n                if (core_1.isFunction(express)) {\n                    var rel = express(method, fullName, targetType, pointcut);\n                    if (idx < expresses.length - 2) {\n                        if (!rel && express[idx + 1] === '&&') {\n                            flag = false;\n                        }\n                        if (rel && express[idx + 1] === '||') {\n                            flag = true;\n                        }\n                    }\n                    else {\n                        flag = rel;\n                    }\n                }\n            });\n            return flag;\n        };\n    };\n    AdviceMatcher.getClassAnnations = function () {\n        return { \"name\": \"AdviceMatcher\", \"params\": { \"constructor\": [\"container\"], \"match\": [\"aspectType\", \"targetType\", \"adviceMetas\", \"target\"], \"matchAspectSelf\": [\"name\", \"metadata\"], \"filterPointcut\": [\"type\", \"points\", \"metadata\", \"target\"], \"matchTypeFactory\": [\"type\", \"metadata\"], \"spiltBrace\": [\"strExp\"], \"expressToFunc\": [\"type\", \"strExp\"], \"tranlateExpress\": [\"type\", \"strExp\"], \"mergeExpress\": [\"expresses\"] } };\n    };\n    AdviceMatcher = tslib_1.__decorate([\n        NonePointcut.NonePointcut(),\n        core_1.Singleton(IAdviceMatcher.AdviceMatcherToken),\n        tslib_1.__param(0, core_1.Inject(core_1.ContainerToken)),\n        tslib_1.__metadata(\"design:paramtypes\", [Object])\n    ], AdviceMatcher);\n    return AdviceMatcher;\n}());\nexports.AdviceMatcher = AdviceMatcher;\n\n\n});\n\nunwrapExports(AdviceMatcher_1);\nvar AdviceMatcher_2 = AdviceMatcher_1.AdviceMatcher;\n\nvar AopModule_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n\n\n\n/**\n * aop ext for ioc. auto run setup after registered.\n * with @IocExt('setup') decorator.\n * @export\n * @class AopModule\n */\nvar AopModule = /** @class */ (function () {\n    function AopModule(container) {\n        this.container = container;\n    }\n    /**\n     * register aop for container.\n     *\n     * @memberof AopModule\n     */\n    AopModule.prototype.setup = function () {\n        var container = this.container;\n        container.register(joinpoints.Joinpoint);\n        container.register(access.AdvisorChainFactory);\n        container.register(access.ReturningRecognizer);\n        container.register(access.SyncProceeding);\n        container.register(access.AsyncPromiseProceeding);\n        container.register(access.AsyncObservableProceeding);\n        container.register(access.AdvisorChain);\n        container.register(access.ProxyMethod);\n        container.register(Advisor_1.Advisor);\n        container.register(AdviceMatcher_1.AdviceMatcher);\n        var lifeScope = container.get(core_1.LifeScopeToken);\n        var factory = new AopActionFactory_1.AopActionFactory();\n        lifeScope.addAction(factory.create(actions.AopActions.registAspect), core_1.IocState.design);\n        lifeScope.addAction(factory.create(actions.AopActions.matchPointcut), core_1.IocState.runtime, core_1.LifeState.beforeConstructor);\n        lifeScope.addAction(factory.create(actions.AopActions.bindMethodPointcut), core_1.IocState.runtime, core_1.LifeState.AfterInit);\n        lifeScope.addAction(factory.create(actions.AopActions.invokeBeforeConstructorAdvices), core_1.IocState.runtime, core_1.LifeState.beforeConstructor);\n        lifeScope.addAction(factory.create(actions.AopActions.exetndsInstance), core_1.IocState.runtime, core_1.LifeState.onInit, core_1.LifeState.afterConstructor);\n        lifeScope.addAction(factory.create(actions.AopActions.invokeAfterConstructorAdvices), core_1.IocState.runtime, core_1.LifeState.afterConstructor);\n        lifeScope.registerDecorator(Aspect.Aspect, actions.AopActions.registAspect, actions.AopActions.exetndsInstance);\n    };\n    AopModule.getClassAnnations = function () {\n        return { \"name\": \"AopModule\", \"params\": { \"constructor\": [\"container\"], \"setup\": [] } };\n    };\n    AopModule = tslib_1.__decorate([\n        core_1.IocExt('setup'),\n        tslib_1.__param(0, core_1.Inject(core_1.ContainerToken)),\n        tslib_1.__metadata(\"design:paramtypes\", [Object])\n    ], AopModule);\n    return AopModule;\n}());\nexports.AopModule = AopModule;\n\n\n});\n\nunwrapExports(AopModule_1);\nvar AopModule_2 = AopModule_1.AopModule;\n\nvar D__workspace_github_tsioc_packages_aop_lib = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(actions, exports);\ntslib_1.__exportStar(decorators, exports);\ntslib_1.__exportStar(joinpoints, exports);\ntslib_1.__exportStar(access, exports);\ntslib_1.__exportStar(IAdvisor, exports);\ntslib_1.__exportStar(Advisor_1, exports);\ntslib_1.__exportStar(AdviceMatcher_1, exports);\ntslib_1.__exportStar(isValideAspectTarget_1, exports);\ntslib_1.__exportStar(AopModule_1, exports);\n\n\n});\n\nvar index$4 = unwrapExports(D__workspace_github_tsioc_packages_aop_lib);\n\nreturn index$4;\n\n})));\n\n//# sourceMappingURL=sourcemaps/aop.umd.js.map\n"]}