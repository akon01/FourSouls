"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var core_1 = require("@ts-ioc/core");
var IAdvisor_1 = require("../IAdvisor");
var AopActions_1 = require("./AopActions");
/**
 * regist aspect action.
 *
 * @export
 * @class RegistAspectAction
 * @extends {ActionComposite}
 */
var RegistAspectAction = /** @class */ (function (_super) {
    tslib_1.__extends(RegistAspectAction, _super);
    function RegistAspectAction() {
        return _super.call(this, AopActions_1.AopActions.registAspect) || this;
    }
    RegistAspectAction.prototype.working = function (container, data) {
        var type = data.targetType;
        var lifeScope = container.getLifeScope();
        var matchs = lifeScope.getClassDecorators(type, function (surm) { return surm.actions.includes(AopActions_1.AopActions.registAspect) && core_1.hasOwnClassMetadata(surm.name, type); });
        var aspectMgr = container.get(IAdvisor_1.AdvisorToken);
        var raiseContainer = data.raiseContainer || container;
        matchs.forEach(function (surm) {
            var metadata = core_1.getOwnTypeMetadata(surm.name, type);
            if (Array.isArray(metadata) && metadata.length > 0) {
                metadata.forEach(function (meta) {
                    if (core_1.isClass(meta.type)) {
                        aspectMgr.add(meta.type, raiseContainer);
                    }
                });
            }
        });
    };
    RegistAspectAction.getClassAnnations = function () {
        return { "name": "RegistAspectAction", "params": { "constructor": [], "working": ["container", "data"] } };
    };
    return RegistAspectAction;
}(core_1.ActionComposite));
exports.RegistAspectAction = RegistAspectAction;

//# sourceMappingURL=../sourcemaps/actions/RegistAspectAction.js.map
